<!DOCTYPE html>
<html>

<head>
  <title>高校教学管理平台</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <link rel="icon" href="/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/dist/semantic.css" />
  <link rel="stylesheet" href="/swiper/package/css/swiper.min.css" />
  <style type="text/css">
    body {
      background-color: #eeeeee;
    }

    .footer.segment {
      padding: 5em 0em;
    }

    .course-title {
      font-weight: bold;
      font-size: medium;
      font-family: "黑体";
      margin: 8px 16px;
    }

    .course-info {
      font-family: "微软雅黑";
      margin: 8px 16px;
    }

    .user-title {
      text-align: center;
      font-size: large;
      font-family: "微软雅黑";
      font-size: 20px;
    }
  </style>
</head>

<body>
  <!-- 课程信息 -->
  <div class="ui container">
    <div class="ui segment" style="margin-top:10px;background-color: rgb(220,220,220);">
      <div class="ui stackable inverted divided equal height stackable grid">
        <div class="four wide column">
          <h2 class="ui header">操作系统</h2>
          <div class="description">
            2019-2020秋冬 计算机科学与技术学院
          </div>
          <h5 class="ui header">授课老师</h5>
          <div class="description">
            夏莹杰
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 课程信息 -->

  <!-- 课程水平菜单 -->
  <div class="ui container" style="margin-top:10px;">
    <div class="ui six item menu">
      <a class="content">
        <a class="item" href="./notice">
          <i class="bell outline icon"></i>
          公告
        </a>
        <a class="item" href="./material">
          <i class="folder outline icon"></i>
          课件
        </a>
        <a class="item" href="./hw/all">
          <i class="pencil alternate icon"></i>
          作业
        </a>
        <a class="item active" href="./groupOperation">
          <i class="users icon"></i>
          分组学习
        </a>
        <a class="item" href="./courseGrade">
          <i class="clipboard outline icon"></i>
          成绩
        </a>
        <a class="item" href="./talk">
          <i class="comment outline icon"></i>
          讨论
        </a>
      </a>
    </div>
  </div>
  <!-- 课程水平菜单 -->

  <!-- 教师完成学生组队操作 -->
  <div class="ui container" style="margin-top:10px;">
    <div class="ui segments" style="background-color:rgb(255, 255, 255);">
      <div class="ui basic segment">
        <div class="ui basic segment">
          <div class="ui grid">
            <div class="four wide column">
              <div class="student group information" style="margin-left: 15px;font-size: 200%;margin-top: 8px;">
                <b>学生组队信息</b></div>
            </div>
            <div class="twelve wide column">
              <div class="ui right floated green labeled icon button" id="addGroup">
                <i class="add icon"></i> 添加小组
              </div>
            </div>

          </div>
        </div>
        <% for(let i=0;i<classGroup.length;i++){ %>
        <div class="ui divider"></div>
        <div class="ui basic segment" style="background-color: rgb(220,220,220);margin-left: 1.5%;margin-right: 1.5%;">
          <div class="ui six column grid">
            <div class="column">
              <div class="group id" style="margin-left: 1%;font-size: 14px;color: black; font-weight: bold;">
                小组序号：<%= classGroup[i].groupNumber %>
              </div>
            </div>
            <div class="column">
              <div class="group membercount" style="margin-left: -10%; font-size: 14px; font-weight: bold;">
                小组人数：<%= classGroupInfoList[i].length %>人
              </div>
            </div>
          </div>
        </div>
        <div class="ui basic segment" style="background-color:rgb(255, 255, 255);">
          <table class="ui compact celled definition table">
            <thead class="full-width">
              <tr>
                <th style="width:80px">选择组长</th>
                <th>姓名</th>
                <th>学号</th>
                <th>邮箱</th>
                <th style="width: 15%"></th>
              </tr>
            </thead>
            <tbody>
              <% for(let j=0;j<classGroupInfoList[i].length;j++){ %>
              <tr>
                <td class="collapsing">
                  <div class="ui radio checkbox" style="margin-left: 20px;">
                    <% if(classGroup[i].groupLeaderID==classGroupInfoList[i][j].studentID){ %>
                    <input type="radio" name="<%= classGroup[i].groupID%>" checked="checked" class="leader">
                    <% } else { %>
                    <input type="radio" name="<%= classGroup[i].groupID%>" class="leader">
                    <% } %>
                    <div class="getStuID" style="display: none;"><%= classGroupInfoList[i][j].userID %></div>
                    <label></label>
                  </div>
                </td>
                <td><%= classGroupInfoList[i][j].userName %></td>
                <td class="studentID"><%= classGroupInfoList[i][j].userID %></td>
                <td><%= classGroupInfoList[i][j].email %></td>
                <td style="text-align: center;">
                  <div class="groupMove" style="cursor: pointer;"><i class="blue sign-out icon"
                      style="display:inline-block"></i><a>删除</a></div>
                </td>
              </tr>
              <% } %>

            </tbody>
            <tfoot class="full-width">
              <tr>
                <th></th>
                <th colspan="4">
                  <div class="ui right floated green labeled icon button addGroupMember">
                    <i class="add icon"></i> 添加组员
                  </div>
                  <div style="display: none;" class="enterGroupIDInfo"><%= classGroup[i].groupID %></div>
                  <div style="display: none;" class="groupNumberNow"><%= classGroupInfoList[i].length %></div>
                  <div style="display: none;" class="groupLeaderID"><%= classGroup[i].groupLeaderID %></div>
                </th>
              </tr>
            </tfoot>
          </table>
        </div>
        <% } %>
        <div class="ui divider"></div>
      </div>
    </div>
  </div>
  <!-- 教师完成学生组队操作 -->

  <!-- 占位 -->
  <div style="height:20px;"></div>
  <!-- 占位 -->

  <!--模态框-->
  <div class="ui modal" id="addGroupTable">
    <i class="close icon"></i>
    <div class="header">
      添加小组
    </div>
    <div class="ui segment" style="background-color:rgb(255, 255, 255);">
      <table class="ui compact celled definition table">
        <thead class="full-width">
          <tr>
            <th></th>
            <th>姓名</th>
            <th>学号</th>
            <th>邮箱</th>
          </tr>
        </thead>
        <tbody>
          <%  for(let i=0;i<leftStudentInfoList.length;i++){ %>
          <tr>
            <td class="collapsing">
              <div class="ui checkbox" style="margin-left: 20px;">
                <input type="checkbox" name="newGroup">
                <div style="display: none;" class="getAddStudentID"><%= leftStudentInfoList[i][0].userID %></div>
                <label></label>
              </div>
            </td>
            <td><%= leftStudentInfoList[i][0].userName %></td>
            <td><%= leftStudentInfoList[i][0].userID %></td>
            <td><%= leftStudentInfoList[i][0].email %></td>
          </tr>
          <%  } %>
        </tbody>
        <tfoot class="full-width">
          <tr>
            <th></th>
            <th colspan="4">
              <a><button class="ui button" id="submit1"
                  style="margin-left: 86%; width: 13%; background-color: #21b90d; color: white">添加小组</button></a>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>

  </div>

  <div class="ui modal" id="addGroupMemberTable">
    <i class="close icon"></i>
    <div class="header">
      添加组员
    </div>
    <div class="ui segment" style="background-color:rgb(255, 255, 255);">
      <table class="ui compact celled definition table">
        <thead class="full-width">
          <tr>
            <th></th>
            <th>姓名</th>
            <th>学号</th>
            <th>邮箱</th>
          </tr>
        </thead>
        <tbody>
          <%  for(let i=0;i<leftStudentInfoList.length;i++){ %>
          <tr>
            <td class="collapsing">
              <div class="ui checkbox" style="margin-left: 20px;">
                <input type="checkbox" name="example">
                <div style="display: none;" class="getAddStudentID"><%= leftStudentInfoList[i][0].userID %></div>
                <label></label>
              </div>
            </td>
            <td><%= leftStudentInfoList[i][0].userName %></td>
            <td><%= leftStudentInfoList[i][0].userID %></td>
            <td><%= leftStudentInfoList[i][0].email %></td>
          </tr>
          <%  } %>
        </tbody>
        <tfoot class="full-width">
          <tr>
            <th></th>
            <th colspan="4">
              <a><button class="ui button" id="submit2"
                  style="margin-left: 86%; width: 13%; background-color: #21b90d; color: white">添加组员</button></a>
              <div style="display: none;" id="enterGroupID"></div>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>

  </div>
  <!--模态框-->

</body>

<script src="/swiper/package/js/swiper.min.js"></script>
<script src="/javascripts/jquery.js"></script>
<script src="/dist/semantic.min.js"></script>
<script src="/javascripts/header.js"></script>
<script>
  $('#addGroup').click(function () {
    $('#addGroupTable').modal('show');
  })

  $('.addGroupMember').click(function () {
    $('#addGroupMemberTable').modal('show')
    $('#enterGroupID').text($(this).siblings('.enterGroupIDInfo').text());
  })

  $('#submit2').click(function () {
    var groupID = $('#enterGroupID').text();
    var addStudentIDList = new Array();
    var count = 0;

    $("input:checkbox[name='example']:checked").each(function () {
      addStudentIDList[count] = $(this).siblings('.getAddStudentID').text();
      count++;
    });

    $.ajax({
      dataType: "json",
      type: "post",
      url: "./addGroupMember",
      traditional: true,
      data: {
        groupID: groupID,
        addStudentIDList: addStudentIDList,
        count: count
      },
      success: (data) => {
        if (data.status) {
          alert("添加成功！");
          window.location.reload();
        } else {
          alert("添加失败！");
        }
      },
      error: (err) => {
        $(".ui.error.message").text("与服务器连接异常，请稍后再试!").show();
      }
    });
  })

  $('.groupMove').click(function () {
    var groupID = $(this).parents('table').find('.enterGroupIDInfo').text();
    var studentID = $(this).parents('td').siblings('.studentID').text();
    var groupMemberCount = $(this).parents('table').find('.groupNumberNow').text();
    var groupLeaderID = $(this).parents('table').find('.groupLeaderID').text();
    $.ajax({
      dataType: "json",
      type: "post",
      url: "./removeGroupMember",
      traditional: true,
      data: {
        groupID: groupID,
        studentID: studentID,
        groupMemberCount: groupMemberCount,
        groupLeaderID: groupLeaderID
      },
      success: (data) => {
        if (data.status) {
          alert("删除成功！");
          window.location.reload();
        } else {
          alert("删除失败！");
        }
      },
      error: (err) => {
        $(".ui.error.message").text("与服务器连接异常，请稍后再试!").show();
      }
    });
  })

  $('.leader').change(function () {
    var groupID = $(this).parents('table').find('.enterGroupIDInfo').text();
    var newLeaderStudentID = $(this).parents('table').find('.leader:checked').siblings('.getStuID').text();
    $.ajax({
      dataType: "json",
      type: "post",
      url: "./changeGroupLeader",
      traditional: true,
      data: {
        groupID: groupID,
        newLeaderStudentID: newLeaderStudentID
      },
      success: (data) => {
        if (data.status) {
          alert("变更成功！");
          window.location.reload();
        } else {
          alert("变更失败！");
        }
      },
      error: (err) => {
        $(".ui.error.message").text("与服务器连接异常，请稍后再试!").show();
      }
    });
  })

  $('#submit1').click(function () {
    var addStudentIDList = new Array();
    var count = 0;
    $("input:checkbox[name='newGroup']:checked").each(function () {
      addStudentIDList[count] = $(this).siblings('.getAddStudentID').text();
      count++;
    });
    $.ajax({
      dataType: "json",
      type: "post",
      url: "./addNewGroup",
      traditional: true,
      data: {
        addStudentIDList: addStudentIDList,
        count: count
      },
      success: (data) => {
        if (data.status) {
          alert("添加成功！");
          window.location.reload();
        } else {
          alert("添加失败！");
        }
      },
      error: (err) => {
        $(".ui.error.message").text("与服务器连接异常，请稍后再试!").show();
      }
    });
  })


</script>

</html>